<app-dashboard-layout>
  <div class="page-header">
    <h2>Quản lý sản phẩm</h2>
  </div>

  <div class="button-add-box">
    <div class="box-search">
      <input
        nz-input
        placeholder="Tìm kiếm sản phẩm"
        [(ngModel)]="searchText"
        (ngModelChange)="onSearch()"
      />
      <div class="search-box">
        <nz-icon nzType="search" nzTheme="outline" class="icon-search"></nz-icon>
      </div>
    </div>

    <button nz-button nzType="primary" (click)="navigateToCreate()">
      <nz-icon nzType="plus" nzTheme="outline" />
      Thêm sản phẩm
    </button>
  </div>

  <div>
    <nz-table
      #basicTable
      [nzData]="listOfData"
      [nzLoading]="loading"
      nzShowPagination="false"
      nzBordered
    >
      <thead>
        <tr>
          <th>ID</th>
          <th>Tên sản phẩm</th>
          <th>SKU</th>
          <th>Giá</th>
          <th>Tồn kho</th>
          <th>Danh mục</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        @for (data of basicTable.data; track data.id) {
          <tr>
            <td>
              {{ (pageIndex - 1) * pageSize + basicTable.data.indexOf(data) + 1 }}
            </td>
            <td>
              <a [routerLink]="'/dashboard/products/edit/' + data.id">{{ data.name }}</a>
            </td>
            <td>{{ data.sku }}</td>
            <td>{{ data.price | number: '1.0-0' }} đ</td>
            <td>{{ data.stock }}</td>
            <td>{{ data.category?.name }}</td>
            <td>
              <nz-tag [nzColor]="data.isActive ? 'green' : 'red'">
                {{ data.isActive ? 'Hoạt động' : 'Tạm dừng' }}
              </nz-tag>
            </td>
            <td>
              <a (click)="showDetail(data)">Xem</a>
              <nz-divider nzType="vertical"></nz-divider>
              <a (click)="showQuickEdit(data)">Sửa nhanh</a>
              <nz-divider nzType="vertical"></nz-divider>
              <a (click)="delete(data.id)" class="text-danger">Xóa</a>
            </td>
          </tr>
        }
      </tbody>
    </nz-table>
  </div>

  <div class="pagination">
    <nz-pagination
      [nzPageIndex]="pageIndex"
      [nzTotal]="total"
      [nzPageSize]="pageSize"
      [nzPageSizeOptions]="[10, 20, 50]"
      (nzPageIndexChange)="onPageChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      [nzShowSizeChanger]="true"
    >
    </nz-pagination>
  </div>
</app-dashboard-layout>

<nz-drawer
  [nzVisible]="drawerVisible"
  [nzWidth]="720"
  [nzTitle]="drawerTitle"
  (nzOnClose)="closeDrawer()"
>
  @if (selectedProduct) {
    @if (isEditMode) {
      <form nz-form [formGroup]="editForm" (ngSubmit)="saveQuickEdit()">
        <nz-form-item>
          <nz-form-label nzRequired>Tên sản phẩm</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="name" placeholder="Tên sản phẩm" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>SKU</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="sku" placeholder="SKU" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>Giá</nz-form-label>
          <nz-form-control>
            <nz-input-number
              formControlName="price"
              [nzMin]="0"
              [nzStep]="1000"
              class="full-width"
            ></nz-input-number>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>Tồn kho</nz-form-label>
          <nz-form-control>
            <nz-input-number
              formControlName="stock"
              [nzMin]="0"
              class="full-width"
            ></nz-input-number>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label>Mô tả</nz-form-label>
          <nz-form-control>
            <textarea
              nz-input
              formControlName="description"
              placeholder="Mô tả"
              [nzAutosize]="{ minRows: 3, maxRows: 6 }"
            ></textarea>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label>Trạng thái</nz-form-label>
          <nz-form-control>
            <label nz-checkbox formControlName="isActive">Hoạt động</label>
          </nz-form-control>
        </nz-form-item>

        <div class="drawer-footer">
          <button type="button" nz-button (click)="closeDrawer()">Hủy</button>
          <button type="submit" nz-button nzType="primary" [nzLoading]="loading">Lưu</button>
        </div>
      </form>
    } @else {
      <nz-descriptions nzBordered [nzColumn]="1">
        <nz-descriptions-item nzTitle="ID">{{ selectedProduct.id }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Tên sản phẩm">{{
          selectedProduct.name
        }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="SKU">{{ selectedProduct.sku }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Giá"
          >{{ selectedProduct.price | number: '1.0-0' }} đ</nz-descriptions-item
        >
        <nz-descriptions-item nzTitle="Tồn kho">{{ selectedProduct.stock }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Danh mục">{{
          selectedProduct.category?.name
        }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Mô tả">{{
          selectedProduct.description
        }}</nz-descriptions-item>
        <nz-descriptions-item nzTitle="Trạng thái">
          <nz-tag [nzColor]="selectedProduct.isActive ? 'green' : 'red'">
            {{ selectedProduct.isActive ? 'Hoạt động' : 'Tạm dừng' }}
          </nz-tag>
        </nz-descriptions-item>
        <nz-descriptions-item nzTitle="Ngày tạo">
          {{ selectedProduct.createdAt | date: 'dd/MM/yyyy HH:mm' }}
        </nz-descriptions-item>
      </nz-descriptions>
    }
  }
</nz-drawer>
